<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="900px" height="547px" version="1.1"
 viewbox="0 0 900 547"
 xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"
 stroke-width="1" text-rendering="geometricPrecision">
<text x="90" y="15" textLength="26" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

Brick
</text>
<text x="270" y="15" textLength="48" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

LocalLog
</text>
<text x="450" y="15" textLength="75" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

LocalLogSync
</text>
<text x="630" y="15" textLength="68" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

CommonLog
</text>
<text x="810" y="15" textLength="95" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

CommonLogSync
</text>
<line x1="90" y1="22" x2="90" y2="47" stroke="black"/>
<line x1="270" y1="22" x2="270" y2="47" stroke="black"/>
<line x1="450" y1="22" x2="450" y2="47" stroke="black"/>
<line x1="630" y1="22" x2="630" y2="47" stroke="black"/>
<line x1="810" y1="22" x2="810" y2="47" stroke="black"/>
<text x="406" y="37" textLength="86" font-family="Helvetica" font-size="12" fill="black">
App initialization
</text>
<line x1="45" y1="34" x2="405" y2="34" stroke="black" stroke-dasharray="2,2"/>
<line x1="495" y1="34" x2="855" y2="34" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="47" x2="90" y2="72" stroke="black"/>
<line x1="270" y1="47" x2="270" y2="72" stroke="black"/>
<line x1="450" y1="47" x2="450" y2="72" stroke="black"/>
<line x1="630" y1="47" x2="630" y2="72" stroke="black"/>
<line x1="810" y1="47" x2="810" y2="72" stroke="black"/>
<path d="M 630 53 A90,6 0 0,1 629,64" stroke="black" fill="none"/><polygon fill="black" points="630,65 640,71 640,59"/>
<text x="506" y="57" textLength="121" font-family="Helvetica" font-size="12" fill="black">
Spawn by supervisor...
</text>
<line x1="90" y1="72" x2="90" y2="97" stroke="black"/>
<line x1="270" y1="72" x2="270" y2="97" stroke="black"/>
<line x1="450" y1="72" x2="450" y2="97" stroke="black"/>
<line x1="630" y1="72" x2="630" y2="97" stroke="black"/>
<line x1="810" y1="72" x2="810" y2="97" stroke="black"/>
<path d="M 630 78 A90,6 0 0,1 629,89" stroke="black" fill="none"/><polygon fill="black" points="630,90 640,96 640,84"/>
<text x="503" y="82" textLength="124" font-family="Helvetica" font-size="12" fill="black">
Open short term log file
</text>
<text x="507" y="92" textLength="120" font-family="Helvetica" font-size="12" fill="black">
Open long term log file
</text>
<line x1="90" y1="97" x2="90" y2="122" stroke="black"/>
<line x1="270" y1="97" x2="270" y2="122" stroke="black"/>
<line x1="450" y1="97" x2="450" y2="122" stroke="black"/>
<line x1="630" y1="97" x2="630" y2="122" stroke="black"/>
<line x1="810" y1="97" x2="810" y2="122" stroke="black"/>
<line x1="630" y1="109" x2="810" y2="109" stroke="black"/>
<line x1="810" y1="109" x2="800" y2="115" stroke="black"/>
<text x="686" y="107" textLength="66" font-family="Helvetica" font-size="12" fill="black">
spawn, init...
</text>
<line x1="90" y1="122" x2="90" y2="147" stroke="black"/>
<line x1="270" y1="122" x2="270" y2="147" stroke="black"/>
<line x1="450" y1="122" x2="450" y2="147" stroke="black"/>
<line x1="630" y1="122" x2="630" y2="147" stroke="black"/>
<line x1="810" y1="122" x2="810" y2="147" stroke="black"/>
<text x="403" y="137" textLength="92" font-family="Helvetica" font-size="12" fill="black">
Brick initialization
</text>
<line x1="45" y1="134" x2="402" y2="134" stroke="black" stroke-dasharray="2,2"/>
<line x1="498" y1="134" x2="855" y2="134" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="147" x2="90" y2="172" stroke="black"/>
<line x1="270" y1="147" x2="270" y2="172" stroke="black"/>
<line x1="450" y1="147" x2="450" y2="172" stroke="black"/>
<line x1="630" y1="147" x2="630" y2="172" stroke="black"/>
<line x1="810" y1="147" x2="810" y2="172" stroke="black"/>
<line x1="90" y1="159" x2="270" y2="159" stroke="black"/>
<line x1="270" y1="159" x2="260" y2="165" stroke="black"/>
<text x="146" y="157" textLength="66" font-family="Helvetica" font-size="12" fill="black">
spawn, init...
</text>
<line x1="90" y1="172" x2="90" y2="197" stroke="black"/>
<line x1="270" y1="172" x2="270" y2="197" stroke="black"/>
<line x1="450" y1="172" x2="450" y2="197" stroke="black"/>
<line x1="630" y1="172" x2="630" y2="197" stroke="black"/>
<line x1="810" y1="172" x2="810" y2="197" stroke="black"/>
<path d="M 269 189 A90,6 0 0,1 270,178" stroke="black" fill="none"/><polygon fill="black" points="270,190 260,196 260,184"/>
<text x="271" y="182" textLength="124" font-family="Helvetica" font-size="12" fill="black">
Open short term log file
</text>
<text x="271" y="192" textLength="120" font-family="Helvetica" font-size="12" fill="black">
Open long term log file
</text>
<line x1="90" y1="197" x2="90" y2="222" stroke="black"/>
<line x1="270" y1="197" x2="270" y2="222" stroke="black"/>
<line x1="450" y1="197" x2="450" y2="222" stroke="black"/>
<line x1="630" y1="197" x2="630" y2="222" stroke="black"/>
<line x1="810" y1="197" x2="810" y2="222" stroke="black"/>
<line x1="90" y1="209" x2="450" y2="209" stroke="black"/>
<line x1="450" y1="209" x2="440" y2="215" stroke="black"/>
<text x="236" y="207" textLength="66" font-family="Helvetica" font-size="12" fill="black">
spawn, init...
</text>
<line x1="90" y1="222" x2="90" y2="247" stroke="black"/>
<line x1="270" y1="222" x2="270" y2="247" stroke="black"/>
<line x1="450" y1="222" x2="450" y2="247" stroke="black"/>
<line x1="630" y1="222" x2="630" y2="247" stroke="black"/>
<line x1="810" y1="222" x2="810" y2="247" stroke="black"/>
<text x="372" y="237" textLength="154" font-family="Helvetica" font-size="12" fill="black">
Write a hunk asynchronously
</text>
<line x1="45" y1="234" x2="371" y2="234" stroke="black" stroke-dasharray="2,2"/>
<line x1="529" y1="234" x2="855" y2="234" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="247" x2="90" y2="272" stroke="black"/>
<line x1="270" y1="247" x2="270" y2="272" stroke="black"/>
<line x1="450" y1="247" x2="450" y2="272" stroke="black"/>
<line x1="630" y1="247" x2="630" y2="272" stroke="black"/>
<line x1="810" y1="247" x2="810" y2="272" stroke="black"/>
<path d="M 89 264 A90,6 0 0,1 90,253" stroke="black" fill="none"/><polygon fill="black" points="90,265 80,271 80,259"/>
<text x="91" y="257" textLength="86" font-family="Helvetica" font-size="12" fill="black">
Checksum hunk
</text>
<text x="91" y="267" textLength="115" font-family="Helvetica" font-size="12" fill="black">
Format hunk -&gt; Bytes
</text>
<line x1="90" y1="272" x2="90" y2="297" stroke="black"/>
<line x1="270" y1="272" x2="270" y2="297" stroke="black"/>
<line x1="450" y1="272" x2="450" y2="297" stroke="black"/>
<line x1="630" y1="272" x2="630" y2="297" stroke="black"/>
<line x1="810" y1="272" x2="810" y2="297" stroke="black"/>
<line x1="90" y1="284" x2="270" y2="284" stroke="black"/>
<polygon fill="black" points="270,284 260,290 260,278"/>
<text x="4294967295" y="282" textLength="427" font-family="Helvetica" font-size="12" fill="black">
write_hunk(LocalLog,BrName,metadata | bigblob,Key,TypeNum,CBlobs,UBlobs)
</text>
<line x1="90" y1="297" x2="90" y2="322" stroke="black"/>
<line x1="270" y1="297" x2="270" y2="322" stroke="black"/>
<line x1="450" y1="297" x2="450" y2="322" stroke="black"/>
<line x1="630" y1="297" x2="630" y2="322" stroke="black"/>
<line x1="810" y1="297" x2="810" y2="322" stroke="black"/>
<path d="M 269 314 A90,6 0 0,1 270,303" stroke="black" fill="none"/><polygon fill="black" points="270,315 260,321 260,309"/>
<text x="271" y="307" textLength="156" font-family="Helvetica" font-size="12" fill="black">
Get current SeqNum &amp; Offset
</text>
<line x1="90" y1="322" x2="90" y2="347" stroke="black"/>
<line x1="270" y1="322" x2="270" y2="347" stroke="black"/>
<line x1="450" y1="322" x2="450" y2="347" stroke="black"/>
<line x1="630" y1="322" x2="630" y2="347" stroke="black"/>
<line x1="810" y1="322" x2="810" y2="347" stroke="black"/>
<line x1="270" y1="334" x2="630" y2="334" stroke="black"/>
<polygon fill="black" points="630,334 620,340 620,328"/>
<text x="274" y="332" textLength="351" font-family="Helvetica" font-size="12" fill="black">
{write_hunk,BrName,metadata | bigblob,Key,TypeNum,Len,Bytes}
</text>
<line x1="90" y1="347" x2="90" y2="372" stroke="black"/>
<line x1="270" y1="347" x2="270" y2="372" stroke="black"/>
<line x1="450" y1="347" x2="450" y2="372" stroke="black"/>
<line x1="630" y1="347" x2="630" y2="372" stroke="black"/>
<line x1="810" y1="347" x2="810" y2="372" stroke="black"/>
<path d="M 630 353 A90,6 0 0,1 629,364" stroke="black" fill="none"/><polygon fill="black" points="630,365 640,371 640,359"/>
<text x="303" y="357" textLength="324" font-family="Helvetica" font-size="12" fill="black">
Write to shortterm storage, using *un*checksummed wrapper
</text>
<text x="432" y="367" textLength="195" font-family="Helvetica" font-size="12" fill="black">
Contents are already checksummed!
</text>
<line x1="90" y1="372" x2="90" y2="397" stroke="black"/>
<line x1="270" y1="372" x2="270" y2="397" stroke="black"/>
<line x1="450" y1="372" x2="450" y2="397" stroke="black"/>
<line x1="630" y1="372" x2="630" y2="397" stroke="black"/>
<line x1="810" y1="372" x2="810" y2="397" stroke="black"/>
<line x1="630" y1="384" x2="270" y2="384" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="black" points="270,384 280,390 280,378"/>
<text x="378" y="382" textLength="143" font-family="Helvetica" font-size="12" fill="black">
{ok, C_SeqNum, C_Offset}
</text>
<line x1="90" y1="397" x2="90" y2="422" stroke="black"/>
<line x1="270" y1="397" x2="270" y2="422" stroke="black"/>
<line x1="450" y1="397" x2="450" y2="422" stroke="black"/>
<line x1="630" y1="397" x2="630" y2="422" stroke="black"/>
<line x1="810" y1="397" x2="810" y2="422" stroke="black"/>
<path d="M 269 414 A90,6 0 0,1 270,403" stroke="black" fill="none"/><polygon fill="black" points="270,415 260,421 260,409"/>
<text x="271" y="407" textLength="251" font-family="Helvetica" font-size="12" fill="black">
If metadata, ignore common's seq num &amp; offset
</text>
<text x="271" y="417" textLength="226" font-family="Helvetica" font-size="12" fill="black">
Increment local offset and maybe seq num
</text>
<line x1="90" y1="422" x2="90" y2="447" stroke="black"/>
<line x1="270" y1="422" x2="270" y2="447" stroke="black"/>
<line x1="450" y1="422" x2="450" y2="447" stroke="black"/>
<line x1="630" y1="422" x2="630" y2="447" stroke="black"/>
<line x1="810" y1="422" x2="810" y2="447" stroke="black"/>
<path d="M 269 439 A90,6 0 0,1 270,428" stroke="black" fill="none"/><polygon fill="black" points="270,440 260,446 260,434"/>
<text x="271" y="432" textLength="214" font-family="Helvetica" font-size="12" fill="black">
If bigblob, return C_SeqNum &amp; C_Offset
</text>
<line x1="90" y1="447" x2="90" y2="472" stroke="black"/>
<line x1="270" y1="447" x2="270" y2="472" stroke="black"/>
<line x1="450" y1="447" x2="450" y2="472" stroke="black"/>
<line x1="630" y1="447" x2="630" y2="472" stroke="black"/>
<line x1="810" y1="447" x2="810" y2="472" stroke="black"/>
<line x1="270" y1="459" x2="90" y2="459" stroke="black"/>
<line x1="90" y1="459" x2="100" y2="465" stroke="black"/>
<text x="123" y="457" textLength="112" font-family="Helvetica" font-size="12" fill="black">
{ok, SeqNum, Offset}
</text>
<line x1="90" y1="472" x2="90" y2="497" stroke="black"/>
<line x1="270" y1="472" x2="270" y2="497" stroke="black"/>
<line x1="450" y1="472" x2="450" y2="497" stroke="black"/>
<line x1="630" y1="472" x2="630" y2="497" stroke="black"/>
<line x1="810" y1="472" x2="810" y2="497" stroke="black"/>
<path d="M 89 489 A90,6 0 0,1 90,478" stroke="black" fill="none"/><polygon fill="black" points="90,490 80,496 80,484"/>
<text x="91" y="482" textLength="162" font-family="Helvetica" font-size="12" fill="black">
Send Mods downstream, etc...
</text>
<line x1="90" y1="497" x2="90" y2="522" stroke="black" stroke-dasharray="2,2"/>
<line x1="270" y1="497" x2="270" y2="522" stroke="black" stroke-dasharray="2,2"/>
<line x1="450" y1="497" x2="450" y2="522" stroke="black" stroke-dasharray="2,2"/>
<line x1="630" y1="497" x2="630" y2="522" stroke="black" stroke-dasharray="2,2"/>
<line x1="810" y1="497" x2="810" y2="522" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="522" x2="90" y2="547" stroke="black"/>
<line x1="270" y1="522" x2="270" y2="547" stroke="black"/>
<line x1="450" y1="522" x2="450" y2="547" stroke="black"/>
<line x1="630" y1="522" x2="630" y2="547" stroke="black"/>
<line x1="810" y1="522" x2="810" y2="547" stroke="black"/>
<text x="295" y="537" textLength="308" font-family="Helvetica" font-size="12" fill="black">
Lazy write-back flow is omitted here, see write-back flows.
</text>
<line x1="45" y1="534" x2="294" y2="534" stroke="black" stroke-dasharray="2,2"/>
<line x1="606" y1="534" x2="855" y2="534" stroke="black" stroke-dasharray="2,2"/>
</svg>
