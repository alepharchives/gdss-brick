<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="900px" height="577px" version="1.1"
 viewbox="0 0 900 577"
 xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"
 stroke-width="1" text-rendering="geometricPrecision">
<text x="90" y="15" textLength="103" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

CommonWriteBack
</text>
<text x="270" y="15" textLength="48" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

LocalLog
</text>
<text x="450" y="15" textLength="56" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

HelpProc1
</text>
<text x="630" y="15" textLength="68" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

CommonLog
</text>
<text x="810" y="15" textLength="26" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

Brick
</text>
<line x1="90" y1="22" x2="90" y2="47" stroke="black"/>
<line x1="270" y1="22" x2="270" y2="47" stroke="black"/>
<line x1="450" y1="22" x2="450" y2="47" stroke="black"/>
<line x1="630" y1="22" x2="630" y2="47" stroke="black"/>
<line x1="810" y1="22" x2="810" y2="47" stroke="black"/>
<text x="335" y="37" textLength="229" font-family="Helvetica" font-size="12" fill="black">
Async write-back of key_hunk index hunks.
</text>
<line x1="45" y1="34" x2="334" y2="34" stroke="black" stroke-dasharray="2,2"/>
<line x1="567" y1="34" x2="855" y2="34" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="47" x2="90" y2="72" stroke="black"/>
<line x1="270" y1="47" x2="270" y2="72" stroke="black"/>
<line x1="450" y1="47" x2="450" y2="72" stroke="black"/>
<line x1="630" y1="47" x2="630" y2="72" stroke="black"/>
<line x1="810" y1="47" x2="810" y2="72" stroke="black"/>
<path d="M 89 64 A90,6 0 0,1 90,53" stroke="black" fill="none"/><polygon fill="black" points="90,65 80,71 80,59"/>
<text x="91" y="57" textLength="181" font-family="Helvetica" font-size="12" fill="black">
Wake up via periodic timer (1 sec)
</text>
<line x1="90" y1="72" x2="90" y2="97" stroke="black"/>
<line x1="270" y1="72" x2="270" y2="97" stroke="black"/>
<line x1="450" y1="72" x2="450" y2="97" stroke="black"/>
<line x1="630" y1="72" x2="630" y2="97" stroke="black"/>
<line x1="810" y1="72" x2="810" y2="97" stroke="black"/>
<path d="M 89 89 A90,6 0 0,1 90,78" stroke="black" fill="none"/><polygon fill="black" points="90,90 80,96 80,84"/>
<text x="91" y="82" textLength="531" font-family="Helvetica" font-size="12" fill="black">
For all metadata hunks since last wake-up, read {BrName,SeqNum,Offset,Key,TypeNum,Len,Bytes}
</text>
<text x="91" y="92" textLength="196" font-family="Helvetica" font-size="12" fill="black">
from CommonLog shortterm storage.
</text>
<line x1="90" y1="97" x2="90" y2="144" stroke="black"/>
<line x1="270" y1="97" x2="270" y2="144" stroke="black"/>
<line x1="450" y1="97" x2="450" y2="144" stroke="black"/>
<line x1="630" y1="97" x2="630" y2="144" stroke="black"/>
<line x1="810" y1="97" x2="810" y2="144" stroke="black"/>
<path d="M 89 125 A90,6 0 0,1 90,114" stroke="black" fill="none"/><polygon fill="black" points="90,126 80,132 80,120"/>
<text x="91" y="107" textLength="357" font-family="Helvetica" font-size="12" fill="black">
Use BrName &amp; SeqNum to calculate LocalLog's shortterm file path.
</text>
<text x="91" y="117" textLength="169" font-family="Helvetica" font-size="12" fill="black">
Open file or use cached handle.
</text>
<text x="91" y="127" textLength="63" font-family="Helvetica" font-size="12" fill="black">
Write bytes.
</text>
<line x1="90" y1="144" x2="90" y2="169" stroke="black" stroke-dasharray="2,2"/>
<line x1="270" y1="144" x2="270" y2="169" stroke="black" stroke-dasharray="2,2"/>
<line x1="450" y1="144" x2="450" y2="169" stroke="black" stroke-dasharray="2,2"/>
<line x1="630" y1="144" x2="630" y2="169" stroke="black" stroke-dasharray="2,2"/>
<line x1="810" y1="144" x2="810" y2="169" stroke="black" stroke-dasharray="2,2"/>
<text x="343" y="159" textLength="212" font-family="Helvetica" font-size="12" fill="black">
'brick_dirty_buffer_wait' seconds elapse
</text>
<line x1="90" y1="169" x2="90" y2="194" stroke="black"/>
<line x1="270" y1="169" x2="270" y2="194" stroke="black"/>
<line x1="450" y1="169" x2="450" y2="194" stroke="black"/>
<line x1="630" y1="169" x2="630" y2="194" stroke="black"/>
<line x1="810" y1="169" x2="810" y2="194" stroke="black"/>
<path d="M 89 186 A90,6 0 0,1 90,175" stroke="black" fill="none"/><polygon fill="black" points="90,187 80,193 80,181"/>
<text x="91" y="179" textLength="158" font-family="Helvetica" font-size="12" fill="black">
Write writeback status to disk.
</text>
<text x="91" y="189" textLength="0" font-family="Helvetica" font-size="12" fill="black">

</text>
<line x1="90" y1="194" x2="90" y2="219" stroke="black"/>
<line x1="270" y1="194" x2="270" y2="219" stroke="black"/>
<line x1="450" y1="194" x2="450" y2="219" stroke="black"/>
<line x1="630" y1="194" x2="630" y2="219" stroke="black"/>
<line x1="810" y1="194" x2="810" y2="219" stroke="black"/>
<text x="228" y="209" textLength="443" font-family="Helvetica" font-size="12" fill="black">
Async relocation of bigdata value hunks to longterm storage **inside common** log.
</text>
<line x1="45" y1="206" x2="227" y2="206" stroke="black" stroke-dasharray="2,2"/>
<line x1="674" y1="206" x2="855" y2="206" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="219" x2="90" y2="244" stroke="black"/>
<line x1="270" y1="219" x2="270" y2="244" stroke="black"/>
<line x1="450" y1="219" x2="450" y2="244" stroke="black"/>
<line x1="630" y1="219" x2="630" y2="244" stroke="black"/>
<line x1="810" y1="219" x2="810" y2="244" stroke="black"/>
<path d="M 89 236 A90,6 0 0,1 90,225" stroke="black" fill="none"/><polygon fill="black" points="90,237 80,243 80,231"/>
<text x="91" y="229" textLength="520" font-family="Helvetica" font-size="12" fill="black">
For all bigblob hunks since last wake-up, read {BrName,SeqNum,Offset,Key,TypeNum,Len,Bytes}
</text>
<text x="91" y="239" textLength="196" font-family="Helvetica" font-size="12" fill="black">
from CommonLog shortterm storage.
</text>
<line x1="90" y1="244" x2="90" y2="269" stroke="black"/>
<line x1="270" y1="244" x2="270" y2="269" stroke="black"/>
<line x1="450" y1="244" x2="450" y2="269" stroke="black"/>
<line x1="630" y1="244" x2="630" y2="269" stroke="black"/>
<line x1="810" y1="244" x2="810" y2="269" stroke="black"/>
<path d="M 89 261 A90,6 0 0,1 90,250" stroke="black" fill="none"/><polygon fill="black" points="90,262 80,268 80,256"/>
<text x="91" y="254" textLength="308" font-family="Helvetica" font-size="12" fill="black">
If shortterm and longterm are on same device, do nothing.
</text>
<text x="91" y="264" textLength="271" font-family="Helvetica" font-size="12" fill="black">
gmt_hlog:move_seq_to_longterm() will work for us.
</text>
<line x1="90" y1="269" x2="90" y2="294" stroke="black"/>
<line x1="270" y1="269" x2="270" y2="294" stroke="black"/>
<line x1="450" y1="269" x2="450" y2="294" stroke="black"/>
<line x1="630" y1="269" x2="630" y2="294" stroke="black"/>
<line x1="810" y1="269" x2="810" y2="294" stroke="black"/>
<path d="M 89 286 A90,6 0 0,1 90,275" stroke="black" fill="none"/><polygon fill="black" points="90,287 80,293 80,281"/>
<text x="91" y="279" textLength="502" font-family="Helvetica" font-size="12" fill="black">
If shortterm and longterm are on different devices, copy *all* shortterm bytes since last wakeup
</text>
<text x="91" y="289" textLength="206" font-family="Helvetica" font-size="12" fill="black">
to (-SeqNum) file in longterm directory.
</text>
<line x1="90" y1="294" x2="90" y2="319" stroke="black" stroke-dasharray="2,2"/>
<line x1="270" y1="294" x2="270" y2="319" stroke="black" stroke-dasharray="2,2"/>
<line x1="450" y1="294" x2="450" y2="319" stroke="black" stroke-dasharray="2,2"/>
<line x1="630" y1="294" x2="630" y2="319" stroke="black" stroke-dasharray="2,2"/>
<line x1="810" y1="294" x2="810" y2="319" stroke="black" stroke-dasharray="2,2"/>
<text x="343" y="309" textLength="212" font-family="Helvetica" font-size="12" fill="black">
'brick_dirty_buffer_wait' seconds elapse
</text>
<line x1="90" y1="319" x2="90" y2="344" stroke="black"/>
<line x1="270" y1="319" x2="270" y2="344" stroke="black"/>
<line x1="450" y1="319" x2="450" y2="344" stroke="black"/>
<line x1="630" y1="319" x2="630" y2="344" stroke="black"/>
<line x1="810" y1="319" x2="810" y2="344" stroke="black"/>
<path d="M 89 336 A90,6 0 0,1 90,325" stroke="black" fill="none"/><polygon fill="black" points="90,337 80,343 80,331"/>
<text x="91" y="329" textLength="158" font-family="Helvetica" font-size="12" fill="black">
Write writeback status to disk.
</text>
<text x="91" y="339" textLength="0" font-family="Helvetica" font-size="12" fill="black">

</text>
<line x1="90" y1="344" x2="90" y2="402" stroke="black"/>
<line x1="270" y1="344" x2="270" y2="402" stroke="black"/>
<line x1="450" y1="344" x2="450" y2="402" stroke="black"/>
<line x1="630" y1="344" x2="630" y2="402" stroke="black"/>
<line x1="810" y1="344" x2="810" y2="402" stroke="black"/>
<path d="M 89 377 A90,6 0 0,1 90,366" stroke="black" fill="none"/><polygon fill="black" points="90,378 80,384 80,372"/>
<text x="91" y="354" textLength="353" font-family="Helvetica" font-size="12" fill="black">
For all shortterm files at least 'brick_dirty_buffer_wait' seconds old:
</text>
<text x="91" y="364" textLength="414" font-family="Helvetica" font-size="12" fill="black">
* If shortterm and longterm are on same device, call move_seq_to_longterm().
</text>
<text x="91" y="374" textLength="380" font-family="Helvetica" font-size="12" fill="black">
* If shortterm and longterm are on different devices, delete the hunk file:
</text>
<text x="91" y="384" textLength="273" font-family="Helvetica" font-size="12" fill="black">
    contents are in longterm &amp; flushed by OS to disk.
</text>
<line x1="90" y1="402" x2="90" y2="427" stroke="black" stroke-dasharray="2,2"/>
<line x1="270" y1="402" x2="270" y2="427" stroke="black" stroke-dasharray="2,2"/>
<line x1="450" y1="402" x2="450" y2="427" stroke="black" stroke-dasharray="2,2"/>
<line x1="630" y1="402" x2="630" y2="427" stroke="black" stroke-dasharray="2,2"/>
<line x1="810" y1="402" x2="810" y2="427" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="427" x2="90" y2="452" stroke="black"/>
<line x1="270" y1="427" x2="270" y2="452" stroke="black"/>
<line x1="450" y1="427" x2="450" y2="452" stroke="black"/>
<line x1="630" y1="427" x2="630" y2="452" stroke="black"/>
<line x1="810" y1="427" x2="810" y2="452" stroke="black"/>
<path d="M 810 433 A90,6 0 0,1 809,444" stroke="black" fill="none"/><polygon fill="black" points="810,445 820,451 820,439"/>
<text x="345" y="437" textLength="462" font-family="Helvetica" font-size="12" fill="black">
Any access to bigblob hunks by a brick is done by opening a file handle directly into the
</text>
<text x="335" y="447" textLength="472" font-family="Helvetica" font-size="12" fill="black">
CommonLog's shortterm/longterm directory, opening the +/-SeqNum file, seek, and read.
</text>
<line x1="90" y1="452" x2="90" y2="477" stroke="black" stroke-dasharray="2,2"/>
<line x1="270" y1="452" x2="270" y2="477" stroke="black" stroke-dasharray="2,2"/>
<line x1="450" y1="452" x2="450" y2="477" stroke="black" stroke-dasharray="2,2"/>
<line x1="630" y1="452" x2="630" y2="477" stroke="black" stroke-dasharray="2,2"/>
<line x1="810" y1="452" x2="810" y2="477" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="477" x2="90" y2="502" stroke="black"/>
<line x1="270" y1="477" x2="270" y2="502" stroke="black"/>
<line x1="450" y1="477" x2="450" y2="502" stroke="black"/>
<line x1="630" y1="477" x2="630" y2="502" stroke="black"/>
<line x1="810" y1="477" x2="810" y2="502" stroke="black"/>
<path d="M 630 483 A90,6 0 0,1 629,494" stroke="black" fill="none"/><polygon fill="black" points="630,495 640,501 640,489"/>
<text x="237" y="487" textLength="390" font-family="Helvetica" font-size="12" fill="black">
Scavenger will eventually remove metadata hunks from longterm storage.
</text>
<line x1="90" y1="502" x2="90" y2="527" stroke="black" stroke-dasharray="2,2"/>
<line x1="270" y1="502" x2="270" y2="527" stroke="black" stroke-dasharray="2,2"/>
<line x1="450" y1="502" x2="450" y2="527" stroke="black" stroke-dasharray="2,2"/>
<line x1="630" y1="502" x2="630" y2="527" stroke="black" stroke-dasharray="2,2"/>
<line x1="810" y1="502" x2="810" y2="527" stroke="black" stroke-dasharray="2,2"/>
<line x1="90" y1="527" x2="90" y2="552" stroke="black"/>
<line x1="270" y1="527" x2="270" y2="552" stroke="black"/>
<line x1="450" y1="527" x2="450" y2="552" stroke="black"/>
<line x1="630" y1="527" x2="630" y2="552" stroke="black"/>
<line x1="810" y1="527" x2="810" y2="552" stroke="black"/>
<path d="M 630 533 A90,6 0 0,1 629,544" stroke="black" fill="none"/><polygon fill="black" points="630,545 640,551 640,539"/>
<text x="198" y="537" textLength="429" font-family="Helvetica" font-size="12" fill="black">
Scavenger must be aware of still-in-use value blobs from all bricks on the node().
</text>
<line x1="90" y1="552" x2="90" y2="577" stroke="black"/>
<line x1="270" y1="552" x2="270" y2="577" stroke="black"/>
<line x1="450" y1="552" x2="450" y2="577" stroke="black"/>
<line x1="630" y1="552" x2="630" y2="577" stroke="black"/>
<line x1="810" y1="552" x2="810" y2="577" stroke="black"/>
<path d="M 630 558 A90,6 0 0,1 629,569" stroke="black" fill="none"/><polygon fill="black" points="630,570 640,576 640,564"/>
<text x="351" y="562" textLength="276" font-family="Helvetica" font-size="12" fill="black">
Scavenger integration with is still in progress............
</text>
</svg>
